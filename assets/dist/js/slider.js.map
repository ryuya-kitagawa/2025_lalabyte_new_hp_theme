{"version":3,"file":"slider.js","sources":["../../src/js/slider.js"],"sourcesContent":["// =============================================================================\r\n// slider.js - 無限スクロールスライダー\r\n// =============================================================================\r\n// フェーズ3：jQuery置換完了（DOM API版）\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\t// 二重初期化防止フラグ\r\n\tlet isInitialized = false;\r\n\r\n\twindow.addEventListener('load', function () {\r\n\t\tconst sliderList = document.querySelector('.slider-list');\r\n\t\t\r\n\t\t// sliderが存在しないページでは何もしない\r\n\t\tif (!sliderList) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// 既に初期化済みの場合は何もしない\r\n\t\tif (isInitialized) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tisInitialized = true;\r\n\r\n\t\t// prefers-reduced-motion を尊重\r\n\t\tconst prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;\r\n\t\tif (prefersReducedMotion) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst duration = 20000; // 20秒\r\n\r\n\t\t// HTMLを複製（無限ループ用）\r\n\t\tsliderList.insertAdjacentHTML('beforeend', sliderList.innerHTML);\r\n\r\n\t\t/**\r\n\t\t * リストの総幅を計算\r\n\t\t * @returns {number} 総幅（px）\r\n\t\t */\r\n\t\tfunction calculateListWidth() {\r\n\t\t\tlet totalWidth = 0;\r\n\t\t\tconst items = sliderList.querySelectorAll('li');\r\n\t\t\t\r\n\t\t\titems.forEach(function (item) {\r\n\t\t\t\tconst rect = item.getBoundingClientRect();\r\n\t\t\t\tconst style = window.getComputedStyle(item);\r\n\t\t\t\tconst marginLeft = parseFloat(style.marginLeft) || 0;\r\n\t\t\t\tconst marginRight = parseFloat(style.marginRight) || 0;\r\n\t\t\t\ttotalWidth += rect.width + marginLeft + marginRight;\r\n\t\t\t});\r\n\r\n\t\t\tsliderList.style.width = totalWidth + 'px';\r\n\t\t\treturn totalWidth;\r\n\t\t}\r\n\r\n\t\tconst totalWidth = calculateListWidth();\r\n\t\tconst originalWidth = totalWidth / 2;\r\n\r\n\t\t// アニメーション制御用の変数\r\n\t\tlet animationId = null;\r\n\r\n\t\t/**\r\n\t\t * margin-leftを設定\r\n\t\t */\r\n\t\tfunction setMarginLeft(value) {\r\n\t\t\tsliderList.style.marginLeft = value + 'px';\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * 現在のmargin-leftを取得\r\n\t\t */\r\n\t\tfunction getCurrentMargin() {\r\n\t\t\tconst style = window.getComputedStyle(sliderList);\r\n\t\t\treturn parseFloat(style.marginLeft) || 0;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * アニメーションを停止\r\n\t\t */\r\n\t\tfunction stopAnimation() {\r\n\t\t\tif (animationId !== null) {\r\n\t\t\t\tcancelAnimationFrame(animationId);\r\n\t\t\t\tanimationId = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * スクロールアニメーション開始\r\n\t\t * @param {number} startMarginValue - 開始位置（省略時は現在位置）\r\n\t\t * @param {number} targetMarginValue - 目標位置（省略時は-originalWidth）\r\n\t\t * @param {number} durationMs - アニメーション時間（省略時はduration）\r\n\t\t */\r\n\t\tfunction startScrolling(startMarginValue, targetMarginValue, durationMs) {\r\n\t\t\tstopAnimation();\r\n\r\n\t\t\tconst startMargin = startMarginValue !== undefined ? startMarginValue : getCurrentMargin();\r\n\t\t\tconst targetMargin = targetMarginValue !== undefined ? targetMarginValue : -originalWidth;\r\n\t\t\tconst animDuration = durationMs !== undefined ? durationMs : duration;\r\n\t\t\tconst startTime = performance.now();\r\n\r\n\t\t\tfunction animate(currentTime) {\r\n\t\t\t\tconst elapsed = currentTime - startTime;\r\n\t\t\t\tconst progress = Math.min(elapsed / animDuration, 1);\r\n\t\t\t\t\r\n\t\t\t\tconst currentMargin = startMargin + (targetMargin - startMargin) * progress;\r\n\t\t\t\tsetMarginLeft(currentMargin);\r\n\r\n\t\t\t\tif (progress < 1) {\r\n\t\t\t\t\tanimationId = requestAnimationFrame(animate);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// アニメーション完了：リセットして再開\r\n\t\t\t\t\tsetMarginLeft(0);\r\n\t\t\t\t\tstartScrolling();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tanimationId = requestAnimationFrame(animate);\r\n\t\t}\r\n\r\n\t\t// マウスホバー時の制御\r\n\t\tsliderList.addEventListener('mouseenter', function () {\r\n\t\t\t// 停止（jQueryのstop(true)に相当）\r\n\t\t\tstopAnimation();\r\n\t\t});\r\n\r\n\t\tsliderList.addEventListener('mouseleave', function () {\r\n\t\t\t// 現在位置から残りの距離を計算して再開\r\n\t\t\tconst currentMargin = getCurrentMargin();\r\n\t\t\tconst remainingDistance = -originalWidth - currentMargin;\r\n\t\t\tconst remainingDuration = duration * (remainingDistance / -originalWidth);\r\n\r\n\t\t\t// 残り時間でアニメーション再開\r\n\t\t\tstartScrolling(currentMargin, -originalWidth, remainingDuration);\r\n\t\t});\r\n\r\n\t\t// 初期アニメーション開始\r\n\t\tstartScrolling(0, -originalWidth, duration);\r\n\t});\r\n})();\r\n"],"names":["isInitialized","window","addEventListener","sliderList","document","querySelector","matchMedia","matches","duration","insertAdjacentHTML","innerHTML","originalWidth","totalWidth","querySelectorAll","forEach","item","rect","getBoundingClientRect","style","getComputedStyle","marginLeft","parseFloat","marginRight","width","calculateListWidth","animationId","setMarginLeft","value","getCurrentMargin","stopAnimation","cancelAnimationFrame","startScrolling","startMarginValue","targetMarginValue","durationMs","startMargin","targetMargin","animDuration","startTime","performance","now","requestAnimationFrame","animate","currentTime","elapsed","progress","Math","min","currentMargin"],"mappings":"YASC,IAAIA,GAAgB,EAEpBC,OAAOC,iBAAiB,OAAQ,WAC/B,MAAMC,EAAaC,SAASC,cAAc,gBAG1C,IAAKF,EACJ,OAID,GAAIH,EACH,OAEDA,GAAgB,EAIhB,GAD6BC,OAAOK,WAAW,oCAAoCC,QAElF,OAGD,MAAMC,EAAW,IAGjBL,EAAWM,mBAAmB,YAAaN,EAAWO,WAsBtD,MACMC,EAjBN,WACC,IAAIC,EAAa,EAYjB,OAXcT,EAAWU,iBAAiB,MAEpCC,QAAQ,SAAUC,GACvB,MAAMC,EAAOD,EAAKE,wBACZC,EAAQjB,OAAOkB,iBAAiBJ,GAChCK,EAAaC,WAAWH,EAAME,aAAe,EAC7CE,EAAcD,WAAWH,EAAMI,cAAgB,EACrDV,GAAcI,EAAKO,MAAQH,EAAaE,CACzC,GAEAnB,EAAWe,MAAMK,MAAQX,EAAa,KAC/BA,CACR,CAEmBY,GACgB,EAGnC,IAAIC,EAAc,KAKlB,SAASC,EAAcC,GACtBxB,EAAWe,MAAME,WAAaO,EAAQ,IACvC,CAKA,SAASC,IACR,MAAMV,EAAQjB,OAAOkB,iBAAiBhB,GACtC,OAAOkB,WAAWH,EAAME,aAAe,CACxC,CAKA,SAASS,IACY,OAAhBJ,IACHK,qBAAqBL,GACrBA,EAAc,KAEhB,CAQA,SAASM,EAAeC,EAAkBC,EAAmBC,GAC5DL,IAEA,MAAMM,OAAmC,IAArBH,EAAiCA,EAAmBJ,IAClEQ,OAAqC,IAAtBH,EAAkCA,GAAqBtB,EACtE0B,OAA8B,IAAfH,EAA2BA,EAAa1B,EACvD8B,EAAYC,YAAYC,MAkB9Bf,EAAcgB,sBAhBd,SAASC,EAAQC,GAChB,MAAMC,EAAUD,EAAcL,EACxBO,EAAWC,KAAKC,IAAIH,EAAUP,EAAc,GAGlDX,EADsBS,GAAeC,EAAeD,GAAeU,GAG/DA,EAAW,EACdpB,EAAcgB,sBAAsBC,IAGpChB,EAAc,GACdK,IAEF,EAGD,CAGA5B,EAAWD,iBAAiB,aAAc,WAEzC2B,GACD,GAEA1B,EAAWD,iBAAiB,aAAc,WAEzC,MAAM8C,EAAgBpB,IAKtBG,EAAeiB,GAAgBrC,EAHLH,KADCG,EAAgBqC,IACgBrC,GAI5D,GAGAoB,EAAe,GAAIpB,EAAeH,EACnC,EACD"}